---
layout: post
title: Anotomy of a Yeoman application
published: false
---

## The standard application layout

The layout of a Play application is standardized to keep things as simple as
possible. After a first successful compile, a standard Play application looks
like this:


    app                      → Application sources
     └ styles                → Typically Sass sources
     └ scripts               → Typically JavaScript of Coffee sources
     └ index.html            → Main App entry point
    dist                     → Compiled and optimized app
    tasks                    → Source folder for additional Grunt tasks
    temp                     → Compiled assets
    test                     → Source folder for unit or functional tests
    lib                      → Unmanaged libraries dependencies
     └ generators            → Project generators

*Note that in next versions of Yeoman, the app, dist, temp, test, scripts,
styles and images folder name conventions are now just that and can be
changed if needed.*

## The app/ directory

The `app` directory contains all your application: HTML templates and compiled
assets’ sources.

There are three standard packages in the `app` directory, one for images, CSS stylesheets and JavaScript files.

- `app/scripts`
- `app/styles`
- `app/images`

You can of course add your own packages, for example an `app/utils` package.

## The lib/ directory

The `lib` directory is optional and contains unmanaged library dependencies,
ie. all generators that are not packaged in a plugin, or too tied to the
structure of your current application.

## The tasks/ directory

The `tasks/` directory contains the additional grunt tasks to load in your
application.

## The temp/ directory

The `target` directory contains everything generated by the build system. It
can be useful to know what is generated here.

## The dist/ directory

Is where `yeoman build` output the optimized version of your website / webapp.


## Typical .gitignore file

Generated folders should be ignored by your version control system. Here is the
typical `.gitignore` file for a Yeoman application:

```txt
temp
dist
```

## Paths configuration

Added recently is the support of a much more flexible directory structure, with
support for a really powerful configuration chain.

The key paths identified so far:

- app: path to the app directory, defaults to app/.
- temp: path to the temporary directory, defaults to temp/.
- dist: path to the final output of the build command, defaults to dist/.
- test: path to the tests directory, where the unit tests and the test
  framework runner can be found.
- components: path to the components directory, where stuff installed via
  package manager should be.

Relative to app

- scripts: path to the scripts directory, defaults to scripts/
- styles: path to the scripts directory, defaults to styles/
- vendor: path to the vendor directory, defaults to sciprts/vendor

Courtesy of [config-chain](github.com/dominictarr/config-chain), Yeoman
will now look in the following JSON files, in this order of precedence:

- CLI options
- Environment variable prefixed with `YEOMAN_`
- If you passed an option --config file then from that file
- Local .yeomanrc
- Local config/yeoman
- Local project.json
- $HOME/.yeomanrcrc
- $HOME/.yeoman/config
- $HOME/.config/yeoman
- $HOME/.config/yeoman/config
- the defaults.

Defaults values being:

{% highlight js %}
var defaults = {
  app        : 'app',
  temp       : 'temp',
  dist       : 'dist',
  test       : 'test',
  components : 'components',

  // below paths are used relative to `app`
  scripts    : 'scripts',
  styles     : 'styles',
  images     : 'images',
  vendor     : 'scripts/vendor'
};
{% endhighlight %}

Gruntfile
---------

The result of the configuration chain is then stored as `grunt.config('yeoman',
config)` and used throughout the entire Gruntfile. This is done by using
underscore templates, via the following syntax `<%= yeoman.app %>`. Internally,
we use `grunt.config.process()` to recursively read and process any key or
value via underscore.

{% highlight js %}
grunt.initConfig({

  // Project configuration
  // ---------------------

  // specify an alternate install location for Bower
  bower: {
    dir: '<%= yeoman.app %>/<%= yeoman.components %>'
  },

  // Coffee to JS compilation
  coffee: {
    compile: {
      files: {
        '<%= yeoman.temp %>/<%= yeoman.scripts %>/*.js': '<%= yeoman.app %>/<%= yeoman.scripts %>/**/*.coffee'
      },
      options: {
        basePath: '<%= yeoman.app %>/<%= yeoman.scripts %>'
      }
    }
  },

  // compile .scss/.sass to .css using Compass
  compass: {
    dist: {
      // http://compass-style.org/help/tutorials/configuration-reference/#configuration-properties
      options: {
        css_dir: '<%= yeoman.temp %>/<%= yeoman.styles %>',
        sass_dir: '<%= yeoman.app %>/<%= yeoman.styles %>',
        images_dir: '<%= yeoman.app %>/<%= yeoman.images %>',
        javascripts_dir: '<%= yeoman.temp %>/<%= yeoman.scripts %>',
        force: true
      }
    }
  },

  // ... etc ...
});
{% endhighlight %}


## Generators

Generators are that other thing that are heavily relying on these paths, and
highly coupled to the directory structure.

The Grunt system and the build script can access configuration values via
`grunt.config('yeoman')`. All created generators have the `self.config`
property mapping the value of the Grunt config hash and thus can rely on that
config to figure out where the generation should happen.

But this won't work for:

- App generator like the one invoked on `yeoman init`. No Gruntfile is
  available to read config from.
- Access `this.config.yeoman.paths.app` values all over again will be tedious.

They also have `self.options` property mapping the values of CLI options, and
since they are used as part of the config chain, I thought it might make sense
to use that placeholder instead.

`this.options` in Generators is now the result of the configuration chain, and
have all access to `options.app`, `options.temp`, `options.scripts` and so on.
They also all have sensible default values, increasing consistency across
generators by ensuring these values are always there.

So, before, Generators used to generate files using the following snippet of
code:

{% highlight js %}
this.template('model', 'app/scripts/models/new-model.js');
{% endhighlight %}

They now need to use `this.options.app` and `this.options.scripts` to build the
path prefix.

{% highlight js %}
var dir = path.join(this.options.app, this.options.scripts);
this.template('model', path.join(dir, 'model/new-model.js'));
{% endhighlight %}

It's better, but can be improved a bit more.

`this.path()` is the newly added method aiming to ease the process of joining
paths, resolving key values to their actual value in Yeoman configuration.

Previous example can be rewritten and further reduced to:

{% highlight js %}
this.template('model', this.path('app', 'scripts', 'model/new-model.js'));
{% endhighlight %}

`this.path()` takes any number of arguments, `path.join()`-ing them during the
process. Before doing so, it also tries to resolve the configuration value of
the key provided. If the key was invalid or unknown (as in the case of
`model/new-model.js`, then the argument provided is kept as default value).

## Sample configuration for various setup

**Play 2 app**


{% highlight json %}
{
  "app": "app",
  "temp": "target/yeoman",
  "dist": "yeoman/dist",
  "scripts": "assets/javascript",
  "styles": "assets/stylesheets",
  "vendor": "assets/vendor",
  "test": "test"
}
{% endhighlight %}

**Php Symfony 1.4**

{
  "app": "web",
  "temp": "cache/yeoman",
  "dist": "dist",
  "scripts": "scripts",
  "styles": "styles",
  "vendor": "assets/vendor",
  "test": "test"
}

